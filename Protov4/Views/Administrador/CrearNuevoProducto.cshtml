@{
    Layout = "~/Views/Administrador/_LayoutAdmin.cshtml";
}

<div>
    <h1>Nuevo Producto</h1>
    <form id="crearProductoForm" method="post" action="@Url.Action("NuevoProducto", "Administrador")">
        <label class="Texto1Form" for="nombre">Nombre Producto</label><br>
        <input class="Boton1Form" type="text" id="nombre" name="nombre" required><br />
        <label class="Texto1Form" for="imagen">Imagen</label><br>
        <input class="Boton1Form" type="file" id="imagen"  accept="image/*" required><br>
        <img id="imagen-preview"  src="#" alt="Vista Previa de la Imagen" style="max-width: 200px; display: none;"><br>
        <input hidden id="imagenBase64" name="imagenBase64" />

        <label class="Texto1Form" for="precio">Precio</label><br>
        <div class="input-container">
            <input class="Boton1Form" type="number" id="precio" name="precio" required min="0" step="1" inputmode="numeric">
            <span class="error-message" id="precio-error">Ingrese un valor válido</span>
        </div><br>

        <label class="Texto1Form" for="existencia">Existencias</label><br>
        <div class="input-container">
            <input class="Boton1Form" type="number" id="existencia" name="existencia" required min="0" step="1" inputmode="numeric">
            <span class="error-message" id="existencia-error">Ingrese un valor válido</span>
        </div><br>



        <label class="Texto1Form" for="marca">Marca</label><br>
        <input class="Boton1Form" type="text" id="marca" name="marca" required><br>
        

        <label class="Texto1Form" for="Tipo">Tipo</label><br>
        <select class="ComboForm" id="Tipo" name="Tipo">
            <option value="Procesador">Procesador</option>
            <option value="Gráfica">Gráfica</option>
            <option value="Almacenamiento">Almacenamiento</option>
            <option value="Ram">Ram</option>
            <option value="Fuente">Fuente</option>
            <option value="Placa">Placa</option>
        </select><br />
        <h4 class="espe">Especificaciones</h4>
        <!-- Campos específicos para cada tipo -->
        <div id="tipo-specific">
    
            <!-- Campos para Procesador -->
            <div id="Procesador">
                <label class="Texto1Form " for="velocidad">Velocidad</label><br>
                <input class="Boton1Form" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form" for="modelo">Modelo</label><br>
                <input class="Boton1Form" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form" for="Zócalo">Zócalo</label><br>
                <input class="Boton1Form" type="text" id="Zócalo" name="Zócalo"><br>
            </div>

            <!-- Campos para Gráfica -->
            <div id="Gráfica">
                <label class="Texto1Form" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form" for="modelo">Modelo</label><br>
                <input class="Boton1Form" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form" for="velocidad">Velocidad</label><br>
                <input class="Boton1Form" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form" for="TamañoVRAM">Tamaño VRAM</label><br>
                <input class="Boton1Form" type="text" id="TamañoVRAM" name="TamañoVRAM"><br>

                <label class="Texto1Form" for="Interfaz">Interfaz</label><br>
                <input class="Boton1Form" type="text" id="Interfaz" name="Interfaz"><br>
            </div>

            <!-- Campos para Almacenamiento -->
            <div id="Almacenamiento">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form Interfaz" for="Interfaz">Interfaz</label><br>
                <input class="Boton1Form Interfaz" type="text" id="Interfaz" name="Interfaz"><br>

                <label class="Texto1Form Almacenamiento" for="Almacenamiento">Almacenamiento</label><br>
                <input class="Boton1Form Almacenamiento" type="text" id="Almacenamiento" name="Almacenamiento"><br>

            </div>
            <div id="Ram">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form modelo" for="modelo">Modelo</label><br>
                <input class="Boton1Form modelo" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form velocidad" for="velocidad">Velocidad</label><br>
                <input class="Boton1Form velocidad" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form TecnologiaRAM" for="TecnologiaRAM">Tecnologia RAM</label><br>
                <input class="Boton1Form TecnologiaRAM" type="text" id="TecnologiaRAM" name="TecnologiaRAM"><br>

                <label class="Texto1Form tamañomemoria" for="tamañomemoria">Tamaño Memoria</label><br>
                <input class="Boton1Form tamañomemoria" type="text" id="tamañomemoria" name="tamañomemoria"><br>

            </div>
            <div id="Fuente">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>
            </div>
            <div id="Placa">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form modelo" for="modelo">Modelo</label><br>
                <input class="Boton1Form modelo" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form Zócalo" for="Zócalo">Zócalo</label><br>
                <input class="Boton1Form Zócalo" type="text" id="Zócalo" name="Zócalo"><br>

                <label class="Texto1Form velocidad" for="velocidad">Velocidad</label><br>
                <input class="Boton1Form velocidad" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form TecnologiaRAM" for="TecnologiaRAM">Tecnologia RAM</label><br>
                <input class="Boton1Form TecnologiaRAM" type="text" id="TecnologiaRAM" name="TecnologiaRAM"><br>

               
            </div>

        </div>
        <label class="Texto1Form descripcion" for="Descripcion">Descripción</label><br>
        <button class="btn btn-secondary" type="button" id="agregarCampo">Agregar Descripción</button>
        <div id="campo-dinamico"></div>
        <input type="hidden" id="campos-dinamicos-hidden" name="Descripcion" value="" >

        <button class="btn btn-secondary" type="submit" id="crearProductoBtn">Crear Producto</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var tipoSelect = document.getElementById('Tipo');
        var tipoSpecific = document.getElementById('tipo-specific');

        function hideAllSpecificFields() {
            var tipoCampos = tipoSpecific.children;
            for (var i = 0; i < tipoCampos.length; i++) {
                tipoCampos[i].style.display = 'none';
                setFieldsRequired(tipoCampos[i], false);
            }
        }

        function setFieldsRequired(container, required) {
            var inputElements = container.querySelectorAll('input, select');
            for (var i = 0; i < inputElements.length; i++) {
                inputElements[i].required = required;
            }
        }

        hideAllSpecificFields();

        var initialSelectedValue = tipoSelect.value;
        var initialCamposTipoSeleccionado = document.getElementById(initialSelectedValue);
        if (initialCamposTipoSeleccionado) {
            initialCamposTipoSeleccionado.style.display = 'block';
            setFieldsRequired(initialCamposTipoSeleccionado, true);
        }

        tipoSelect.addEventListener('change', function () {
            hideAllSpecificFields();

            var selectedValue = tipoSelect.value;
            var camposTipoSeleccionado = document.getElementById(selectedValue);
            if (camposTipoSeleccionado) {
                camposTipoSeleccionado.style.display = 'block';
                setFieldsRequired(camposTipoSeleccionado, true);
            }
        });

        document.getElementById('agregarCampo').addEventListener('click', function () {
            var newInput = document.createElement('input');
            newInput.classList.add('Boton1Form');
            newInput.type = 'text';
            newInput.name = 'nuevoCampo[]'; // Cambia el nombre según tus necesidades

            var deleteButton = document.createElement('button');
            deleteButton.textContent = 'Eliminar';
            deleteButton.type = 'button';
            deleteButton.classList.add('btn', 'btn-danger');
            deleteButton.addEventListener('click', function () {
                parentDiv.removeChild(newInput);
                parentDiv.removeChild(deleteButton);
                updateHiddenField();
            });

            var parentDiv = document.getElementById('campo-dinamico');
            parentDiv.appendChild(newInput);
            parentDiv.appendChild(deleteButton);
        });

        var crearProductoForm = document.getElementById('crearProductoForm');

        crearProductoForm.addEventListener('submit', function (event) {
            var inputs = crearProductoForm.querySelectorAll('input[required]');
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].value.trim() === '') {
                    event.preventDefault();
                    alert('Por favor, completa todos los campos requeridos.');
                    return;
                }
            }

            updateHiddenField();
            confirmSubmit();
        });

        function collectSpecificFieldsValues(selectedValue) {
            var specificFields = document.getElementById(selectedValue).querySelectorAll('input, select');
            var fieldValues = {};

            specificFields.forEach(function (field) {
                fieldValues[field.name] = field.value;
            });

            return fieldValues;
        }

        function confirmSubmit() {
            event.preventDefault();
            Swal.fire({
                title: '¿Estás seguro?',
                text: 'Se creará un nuevo producto',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, crear producto',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    var selectedValue = tipoSelect.value;
                    var specificFieldValues = collectSpecificFieldsValues(selectedValue);

                    // Agregar los valores específicos al formulario antes de enviarlo
                    for (var field in specificFieldValues) {
                        var input = document.createElement('input');
                        input.type = 'hidden';
                        input.name = field;
                        input.value = specificFieldValues[field];
                        crearProductoForm.appendChild(input);
                    }

                    crearProductoForm.submit();
                }
            });
        }

        document.getElementById('precio').addEventListener('input', function () {
            var precioError = document.getElementById('precio-error');
            if (this.validity.valid) {
                precioError.style.display = 'none';
            } else {
                precioError.style.display = 'block';
            }
        });

        document.getElementById('existencia').addEventListener('input', function () {
            var existenciaError = document.getElementById('existencia-error');
            if (this.validity.valid) {
                existenciaError.style.display = 'none';
            } else {
                existenciaError.style.display = 'block';
            }
        });

        document.getElementById('imagen').addEventListener('change', function (e) {
            var fileInput = e.target;
            var previewImage = document.getElementById('imagen-preview');
            var imagenBase64Field = document.getElementById('imagenBase64'); // Campo oculto para almacenar la imagen en Base64

            if (fileInput.files && fileInput.files[0]) {
                var reader = new FileReader();

                reader.onload = function (event) {
                    var base64Image = event.target.result;
                    previewImage.src = base64Image;
                    previewImage.style.display = 'block';

                    // Asignar el valor Base64 al campo oculto
                    imagenBase64Field.value = base64Image;
                };

                reader.readAsDataURL(fileInput.files[0]);
            } else {
                previewImage.src = '#';
                previewImage.style.display = 'none';
                imagenBase64Field.value = '';
            }
        });

        function updateHiddenField() {
            var inputs = document.querySelectorAll('#campo-dinamico input');
            var values = Array.from(inputs).map(input => input.value);
            document.getElementById('campos-dinamicos-hidden').value = values.join(',');
        }
    });

</script>

