@{
    Layout = "~/Views/Administrador/_LayoutAdmin.cshtml";
}

<div>
    <h1>Nuevo Producto</h1>
    <form id="crearProductoForm" method="post" action="@Url.Action("NuevoProducto", "Administrador")">
        <label class="Texto1Form" for="nombre">Nombre Producto</label><br>
        <input class="Boton1Form" type="text" id="nombre" name="nombre" required><br />
        <label class="Texto1Form" for="imagen">Imagen</label><br>
        <input class="Boton1Form" type="file" id="imagen" name="imagen" accept="image/*"><br>
        <img id="imagen-preview" src="#" alt="Vista Previa de la Imagen" style="max-width: 200px; display: none;"><br>


        <label class="Texto1Form" for="precio">Precio</label><br>
        <div class="input-container">
            <input class="Boton1Form" type="number" id="precio" name="precio" required min="0" step="1" inputmode="numeric">
            <span class="error-message" id="precio-error">Ingrese un valor válido</span>
        </div><br>

        <label class="Texto1Form" for="existencia">Existencias</label><br>
        <div class="input-container">
            <input class="Boton1Form" type="number" id="existencia" name="existencia" required min="0" step="1" inputmode="numeric">
            <span class="error-message" id="existencia-error">Ingrese un valor válido</span>
        </div><br>



        <label class="Texto1Form" for="marca">Marca</label><br>
        <input class="Boton1Form" type="text" id="marca" name="marca" required><br>
        

        <label class="Texto1Form" for="Tipo">Tipo</label><br>
        <select class="ComboForm" id="Tipo" name="Tipo">
            <option value="Procesador">Procesador</option>
            <option value="Gráfica">Gráfica</option>
            <option value="Almacenamiento">Almacenamiento</option>
            <option value="Ram">Ram</option>
            <option value="Fuente">Fuente</option>
            <option value="Placa">Placa</option>
        </select><br />
        <h4 class="espe">Especificaciones</h4>
        <!-- Campos específicos para cada tipo -->
        <div id="tipo-specific">
    
            <!-- Campos para Procesador -->
            <div id="Procesador">
                <label class="Texto1Form " for="velocidad">Velocidad</label><br>
                <input class="Boton1Form" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form" for="modelo">Modelo</label><br>
                <input class="Boton1Form" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form" for="Zócalo">Zócalo</label><br>
                <input class="Boton1Form" type="text" id="Zócalo" name="Zócalo"><br>

                <label class="Texto1Form" for="descripcion">Descripción</label><br>
                <input class="Boton1Form" type="text" id="descripcion" name="descripcion"><br>
            </div>

            <!-- Campos para Gráfica -->
            <div id="Gráfica">
                <label class="Texto1Form" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form" for="modelo">Modelo</label><br>
                <input class="Boton1Form" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form" for="velocidad">Velocidad</label><br>
                <input class="Boton1Form" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form" for="TamañoVRAM">Tamaño VRAM</label><br>
                <input class="Boton1Form" type="text" id="TamañoVRAM" name="TamañoVRAM"><br>

                <label class="Texto1Form" for="Interfaz">Interfaz</label><br>
                <input class="Boton1Form" type="text" id="Interfaz" name="Interfaz"><br>

                <label class="Texto1Form" for="descripcion">Descripción</label><br>
                <input class="Boton1Form" type="text" id="descripcion" name="descripcion"><br>
            </div>

            <!-- Campos para Almacenamiento -->
            <div id="Almacenamiento">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form Interfaz" for="Interfaz">Interfaz</label><br>
                <input class="Boton1Form Interfaz" type="text" id="Interfaz" name="Interfaz"><br>

                <label class="Texto1Form Almacenamiento" for="Almacenamiento">Almacenamiento</label><br>
                <input class="Boton1Form Almacenamiento" type="text" id="Almacenamiento" name="Almacenamiento"><br>

                <label class="Texto1Form descripcion" for="Descripcion">Descripción</label><br>
                <input class="Boton1Form descripcion" type="text" id="Descripcion" name="Descripcion"><br>
            </div>
            <div id="Ram">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form modelo" for="modelo">Modelo</label><br>
                <input class="Boton1Form modelo" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form velocidad" for="velocidad">Velocidad</label><br>
                <input class="Boton1Form velocidad" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form TecnologiaRAM" for="TecnologiaRAM">Tecnologia RAM</label><br>
                <input class="Boton1Form TecnologiaRAM" type="text" id="TecnologiaRAM" name="TecnologiaRAM"><br>

                <label class="Texto1Form tamañomemoria" for="tamañomemoria">Tamaño Memoria</label><br>
                <input class="Boton1Form tamañomemoria" type="text" id="tamañomemoria" name="tamañomemoria"><br>

                <label class="Texto1Form descripcion" for="Descripcion">Descripción</label><br>
                <input class="Boton1Form descripcion" type="text" id="Descripcion" name="Descripcion"><br>
            </div>
            <div id="Fuente">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form descripcion" for="Descripcion">Descripción</label><br>
                <input class="Boton1Form descripcion" type="text" id="Descripcion" name="Descripcion"><br>
            </div>
            <div id="Placa">
                <label class="Texto1Form fabricante" for="fabricante">Fabricante</label><br>
                <input class="Boton1Form fabricante" type="text" id="fabricante" name="fabricante"><br>

                <label class="Texto1Form modelo" for="modelo">Modelo</label><br>
                <input class="Boton1Form modelo" type="text" id="modelo" name="modelo"><br>

                <label class="Texto1Form Zócalo" for="Zócalo">Zócalo</label><br>
                <input class="Boton1Form Zócalo" type="text" id="Zócalo" name="Zócalo"><br>

                <label class="Texto1Form velocidad" for="velocidad">Velocidad</label><br>
                <input class="Boton1Form velocidad" type="text" id="velocidad" name="velocidad"><br>

                <label class="Texto1Form TecnologiaRAM" for="TecnologiaRAM">Tecnologia RAM</label><br>
                <input class="Boton1Form TecnologiaRAM" type="text" id="TecnologiaRAM" name="TecnologiaRAM"><br>

                <label class="Texto1Form descripcion" for="Descripcion">Descripción</label><br>
                <input class="Boton1Form descripcion" type="text" id="Descripcion" name="Descripcion"><br>
            </div>
        </div>

        <button class="btn btn-secondary" type="submit" id="crearProductoBtn">Crear Producto</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var tipoSelect = document.getElementById('Tipo');
        var tipoSpecific = document.getElementById('tipo-specific');

        function hideAllSpecificFields() {
            var tipoCampos = tipoSpecific.children;
            for (var i = 0; i < tipoCampos.length; i++) {
                tipoCampos[i].style.display = 'none';
                setFieldsRequired(tipoCampos[i], false);
            }
        }

        function setFieldsRequired(container, required) {
            var inputElements = container.querySelectorAll('input, select');
            for (var i = 0; i < inputElements.length; i++) {
                inputElements[i].required = required;
            }
        }

        hideAllSpecificFields();

        var initialSelectedValue = tipoSelect.value;
        var initialCamposTipoSeleccionado = document.getElementById(initialSelectedValue);
        if (initialCamposTipoSeleccionado) {
            initialCamposTipoSeleccionado.style.display = 'block';
            setFieldsRequired(initialCamposTipoSeleccionado, true);
        }

        tipoSelect.addEventListener('change', function () {
            hideAllSpecificFields();

            var selectedValue = tipoSelect.value;
            var camposTipoSeleccionado = document.getElementById(selectedValue);
            if (camposTipoSeleccionado) {
                camposTipoSeleccionado.style.display = 'block';
                setFieldsRequired(camposTipoSeleccionado, true);
            }
        });
    });

    document.getElementById('crearProductoForm').addEventListener('submit', function (e) {
        e.preventDefault();

        Swal.fire({
            title: '¿Estás seguro?',
            text: 'Se creará un nuevo producto',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Sí, crear producto',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                var fileInput = document.getElementById('imagen');
                var file = fileInput.files[0];

                var reader = new FileReader();
                reader.onload = function (event) {
                    var base64Image = event.target.result;

                    var hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = 'imagenBase64';
                    hiddenInput.value = base64Image;
                    document.getElementById('crearProductoForm').appendChild(hiddenInput);

                    document.getElementById('crearProductoForm').submit();
                };

                reader.readAsDataURL(file);
            }
        });
    });

    document.getElementById('precio').addEventListener('input', function () {
        var precioError = document.getElementById('precio-error');
        if (this.validity.valid) {
            precioError.style.display = 'none';
        } else {
            precioError.style.display = 'block';
        }
    });

    document.getElementById('existencia').addEventListener('input', function () {
        var existenciaError = document.getElementById('existencia-error');
        if (this.validity.valid) {
            existenciaError.style.display = 'none';
        } else {
            existenciaError.style.display = 'block';
        }
    });

    document.getElementById('imagen').addEventListener('change', function (e) {
        var fileInput = e.target;
        var previewImage = document.getElementById('imagen-preview');

        if (fileInput.files && fileInput.files[0]) {
            var reader = new FileReader();

            reader.onload = function (event) {
                previewImage.src = event.target.result;
                previewImage.style.display = 'block';
            };

            reader.readAsDataURL(fileInput.files[0]);
        } else {
            previewImage.src = '#';
            previewImage.style.display = 'none';
        }
    });
</script>
